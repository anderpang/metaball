/*! <anderpang@foxmail.com> http://www.wuweierwei.com/ */
"use strict";(function(global,factory){typeof exports==="object"&&typeof module==="object"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.metaball=factory()})(this,function(){function metaball(ball1,ball2,maxDistance){var dx=ball2.x-ball1.x,dy=ball2.y-ball1.y,distance=Math.hypot(dx,dy);if(distance>maxDistance){return null}if(distance<=Math.abs(ball1.radius-ball2.radius)){return null}var percent=distance/maxDistance,ctrlpercent=Math.max(.2,percent)*1.3,cutpercent=1-percent*.5,rad0=Math.acos((ball2.radius-ball1.radius)/distance),rad1=(Math.PI-rad0)*cutpercent,rad2=rad0*cutpercent,cutDots=getCutDots(null,ball1,rad1,distance,dx,dy),cutDots=getCutDots(cutDots,ball2,rad2,distance,-dx,-dy),ctrlDots=[getCtrlDot(cutDots[0],ball1,ctrlpercent,-1),getCtrlDot(cutDots[1],ball1,ctrlpercent,1),getCtrlDot(cutDots[2],ball2,ctrlpercent,-1),getCtrlDot(cutDots[3],ball2,ctrlpercent,1)];return{cutDots:cutDots,ctrlDots:ctrlDots,distance:distance,ratio:percent}}function getCutDots(dots,ball,rad,distance,dx,dy){var cos,sin,x,y,percent;dots=dots||[];percent=ball.radius/distance;x=dx*percent;y=dy*percent;cos=Math.cos(rad);sin=Math.sin(rad);dots.push({x:ball.x+x*cos+y*sin,y:ball.y-x*sin+y*cos});dots.push({x:ball.x+x*cos-y*sin,y:ball.y+x*sin+y*cos});return dots}function getCtrlDot(a,b,percent,dir){return{x:a.x-(b.y-a.y)*percent*dir,y:a.y+(b.x-a.x)*percent*dir}}return metaball});
