/*! <anderpang@foxmail.com> http://www.wuweierwei.com/ */
"use strict";(function(global,factory){typeof exports==="object"&&typeof module==="object"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.metaball=factory()})(this,function(){function metaball(ball1,ball2,maxDistance){var dx=ball2.x-ball1.x,dy=ball2.y-ball1.y,distance=Math.hypot(dx,dy);if(distance>maxDistance){return null}if(distance<=Math.abs(ball1.radius-ball2.radius)){return null}var parcent=distance/maxDistance,ctrlParcent=Math.max(.2,parcent)*1.3,cutParcent=1-parcent*.5,rad0=Math.acos((ball2.radius-ball1.radius)/distance),rad1=(Math.PI-rad0)*cutParcent,rad2=rad0*cutParcent,cutDots=getCutDots(null,ball1,rad1,distance,dx,dy),cutDots=getCutDots(cutDots,ball2,rad2,distance,-dx,-dy),ctrlDots=[getCtrlDot(cutDots[0],ball1,ctrlParcent,-1),getCtrlDot(cutDots[1],ball1,ctrlParcent,1),getCtrlDot(cutDots[2],ball2,ctrlParcent,-1),getCtrlDot(cutDots[3],ball2,ctrlParcent,1)];return{cutDots:cutDots,ctrlDots:ctrlDots}}function getCutDots(dots,ball,rad,distance,dx,dy){var cos,sin,x,y,parcent;dots=dots||[];parcent=ball.radius/distance;x=dx*parcent;y=dy*parcent;cos=Math.cos(rad);sin=Math.sin(rad);dots.push({x:ball.x+x*cos+y*sin,y:ball.y-x*sin+y*cos});dots.push({x:ball.x+x*cos-y*sin,y:ball.y+x*sin+y*cos});return dots}function getCtrlDot(a,b,parcent,dir){return{x:a.x-(b.y-a.y)*parcent*dir,y:a.y+(b.x-a.x)*parcent*dir}}return metaball});
